<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mx-auto my-10">
        <div class="  px-8 pt-6 pb-8 mb-4">
            <div class="mb-4 w-full max-w-lg mx-auto">
                <h2 class="text-xl font-semibold mb-2">Create Rule</h2>
                <input id="ruleInput" type="text" class="border p-2 w-full rounded-md" placeholder="Enter rule string">
                <button onclick="createRule()" class="mt-2 p-2 bg-blue-500 text-white w-full rounded-md">Create
                    Rule</button>
            </div>

            <div class="mb-4 w-full max-w-lg mx-auto">
                <h2 class="text-xl font-semibold mb-2">Combine Rules</h2>
                <button onclick="combineRules()" class="p-2 bg-green-500 text-white w-full rounded-md">Combine
                    Rules</button>
            </div>

            <div class="mb-4 w-full max-w-lg mx-auto">
                <h2 class="text-xl font-semibold mb-2">Evaluate Rule</h2>
                <textarea id="dataInput" class="border p-2 w-full rounded-md" placeholder="Enter data JSON"></textarea>
                <button onclick="evaluateRule()" class="mt-2 p-2 bg-red-500 text-white w-full rounded-md">Evaluate
                    Rule</button>
            </div>

            <div id="astOutput" class="w-full max-w-lg bg-white shadow-lg rounded-lg p-6 mb-6 mx-auto y-overflow-scroll"
                style="height: 150px;">
            </div>
            <div id="evaluationOutput" class="w-full max-w-lg bg-white shadow-lg rounded-lg p-6 mb-6 mx-auto"></div>


        </div>
    </div>

    <script>
        async function createRule() {
            const ruleString = document.getElementById('ruleInput').value;
            const response = await fetch('/api/rules/create_rule', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ruleString })
            });
            const result = await response.json();
            document.getElementById('astOutput').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }

        async function combineRules() {
            const ruleStrings = [document.getElementById('ruleInput').value];
            const response = await fetch('/api/rules/combine_rules', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ruleStrings })
            });
            const result = await response.json();
            document.getElementById('astOutput').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }

        async function evaluateRule() {
            const data = JSON.parse(document.getElementById('dataInput').value);
            const ast = JSON.parse(document.getElementById('astOutput').innerText);
            const response = await fetch('/api/rules/evaluate_rule', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ast, data })
            });
            const result = await response.json();
            document.getElementById('evaluationOutput').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }

    </script>
</body>

</html>